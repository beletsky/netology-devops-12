## Задача 1

> Опишите кратко, как вы поняли: в чем основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС.

- В случае полной виртуализации гипервизор представляет собой фактически операционную систему, работающую на голом железе. Виртуальным машинам в эксклюзивное использование могут выделяться реальные физические устройства -- ядра процессора, диски, периферия. На виртуальных машинах могут быть запущены любые операционные системы без модификаций, причём для них виртуальная машина может быть "прозрачной" - ОС может не знать о том, что она запущена на виртуальной машине, а не на реальной аппаратуре.
- В случае паравиртуализации гипервизор работает поверх некоторой операционной системы, соответственно он не имеет физического доступа к ресурсам аппаратуры, и вынужден работать с абстракциями, предоставляемыми хостовой операционной системой. Возможен запуск любых операционных систем, но зачастую для их работы данном режиме требуется вносить в них какие-то изменения (либо в виде дополнительных драйверов внутри ОС, либо корректировать их поведение на уровне гипервизора).
- В случае виртуализации на основе ОС все виртуальные машины используют единственное ядро ОС хостовой машины. Виртуализация делается ядром ОС путём "скрытия" ресурсов, используемых виртуальными машинами, друг от друга (в случае ОС семейства Linux это так называемые различные namespace).

## Задача 2

> Выберите один из вариантов использования организации физических серверов, в зависимости от условий использования.
> 
> Организация серверов:
> - физические сервера,
> - паравиртуализация,
> - виртуализация уровня ОС.
> 
> Условия использования:
> - Высоконагруженная база данных, чувствительная к отказу.
> - Различные web-приложения.
> - Windows системы для использования бухгалтерским отделом.
> - Системы, выполняющие высокопроизводительные расчеты на GPU.
> 
> Опишите, почему вы выбрали к каждому целевому использованию такую организацию.

- **Высоконагруженная база данных, чувствительная к отказу.**
  
  В данном сценарии необходимо использовать физические сервера. Причины: 1) сервер баз данных генерирует высокую нагрузку на системы хранения данных (СХД), поэтому любые дополнительные задержки будут снижать производительность; 2) при различных действиях с данным (выборке - создании планов выполнения запросов, синхронизации, вставки/обновления) сервер БД учитывает физические характеристики доступа к СХД и её текущую нагрузку (этим же серверов), а в случае использования виртуальных СХД эти характеристики могут существенно меняться по независящим от сервера причинам, что может приводить к существенной просадке производительности; 3) нельзя допускать отказ сервера БД по причине занятости ресурсов сервера другими процессами.
  

- **Различные web-приложения.**

  В данном сценарии идеальным выбором является виртуализация уровня ОС, например, различные варианты и комбинации Kubernetes/Docker/etc. Причины: 1) веб-приложения, как правило, имеют "плавающую" нагрузку и легко горизонтально масштабируются, что позволяет легко разделять общие ресурсы аппаратуры на большое количество одновременно готовых к обслуживанию запросов сервисов (в крайнем случае можно легко задействовать дополнительные мощности, запустив дополнительные экземпляры сервисов); 2) веб-приложения обычно строятся на одном технологическом стеке, что позволяет использовать для них виртуализацию на едином ядре хостовой ОС.
  

- **Windows системы для использования бухгалтерским отделом.**

  Данный сценарий, как правило, подразумевает использование серверов на основе Windows для создания необходимой инфраструктуры: контроллер домена, сервер для хранения данных, сервер базы данных/1С. В этом случае для данных серверов логично выбрать полную виртуализацию на основе Hyper-V Core. Паравиртуализация в данном сценарии работает не очень хорошо, потому что присутствует сервер БД, для которого желательна работа непосредственно на аппаратных ресурсах.

  Для работы конечных пользователей в данном сценарии идеальным является вариант использования терминальных серверов и тонких клиентов у пользователя. Мой опыт создания таких систем очень хорошо себя зарекомендовал простотой обслуживания как физической части (количество серверов минимально, тонкие клиенты практически неубиваемы), так и программной (большинство задач могут быть решены на серверах, вмешательства в работу тонких клиентов не требуется).  


- **Системы, выполняющие высокопроизводительные расчеты на GPU.**

  Использование GPU в настоящее время возможно только в случае аппаратной виртуализации, либо, с некоторыми ограничениями, виртуализации уровня ОС в Linux. 

Подытоживая, нужно отметить, что в силу относительной сложности реализации (необходимость той или иной модификации работы ОС) и проблем с производительностью (так как всегда присутствует слой работы с оборудованием хостовой ОС) систем на основе паравиртуализации, они слабо применимы в рабочем окружении. Зато в силу простоты развёртывания, поддержки и большой универсальности они хорошо подходят для разработки, тестирования, и эпизодических задач конечных пользователей.

## Задача 3

> Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.
> 
> Сценарии:
> 
> 1. 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.
> 2. Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.
> 3. Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.
> 4. Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.

1. Поскольку планируется использование преимущественно Windows, в данном случае предпочтительно выбрать аппаратную виртуализацию на основе Hyper-V Core. Это позволит легко создавать высокопроизводительные сервера Windows, даст возможность балансировать нагрузку путём переноса виртуальных машин между серверами, обеспечит механизмы репликации и резервного копирования. Для небольшого количество виртуальных машин Linux можно использовать хост на Windows, в котором создавать виртуальные машины Linux, либо даже задействовать WSL, что уберёт дополнительный слой виртуализации.

2. Условие "наиболее производительное бесплатное open source" фактически оставляет другого выбора, кроме как предложить использовать паравиртуализацию KVM. Остальные решения либо не являются бесплатными, либо не open source, либо не обеспечивают наилучшей производительности. 

3. Постановка задачи выглядит странно, так как использование Windows инфраструктуры уже подразумевает оплату, и я бы в данном случае настаивал на покупке "родной" системы аппаратной виртуализации Hyper-V Core. Однако, оставаясь в рамках задачи (бесплатное, совместимое, производительное решение), можно предложить либо, как и в предыдущем случае, использовать паравиртуализацию на основе KVM, либо, поскольку теперь условие "open source" отсутствует - бесплатную версию VMware vSphere. 

4. В данном случае идеально подойдёт виртуализация уровня ОС. Поскольку окружение является рабочим и тестовым, оно временное, поэтому излишне даже собственно использование виртуализации, вполне достаточно будет решений типа Kubernetes/Docker/etc. Совершенно не в курсе темы, что происходит в случае какой-либо несовместимости версий ядра для различных дистрибутивов Linux, но даже в этом случае довольно просто будет развернуть несколько хостовых ОС с разными версиями ядра, и этим решить проблему. 

## Задача 4

> Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, то создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.

Недостатки:

1. Необходимость компетенций по нескольким системам одновременно.
2. Вероятны отличия аппаратных конфигураций для разных систем, что не позволит задействовать железо из-под одной среды в другой.
3. Невозможность балансировки нагрузки между средами (перенос ВМ невозможен).

Решения по минимизации проблем достаточно типовые:

1. Развитие компетенций внутри компании (с резервированием сотрудников), либо передача мало используемой среды на аутсорс.
2. При возможности, планирование и реализация перехода на единую среду виртуализации.
3. Подбор взаимозаменяемых аппаратных решений.
4. Резервирование аппаратных ресурсов во всех используемых средах.

Как обычно бывает в подобных задачах, наиболее правильный ответ на мой взгляд "it depends".

Разумеется, если подавляющее большинство требующих решения задач может быть реализовано под одной системой виртуализации, для оставшихся я бы предложил поискать возможную замену, либо решить их возможно не самым оптимальным образом, но оставаясь в рамках единой среды (например, поднять несколько серверов Windows на VirtualBox внутри серверов Linux - не самое производительное решение, но вполне может работать в рамках планируемых нагрузок). Пример конфигурации: контроллер домена Windows Active Directory, нужный для обслуживания Hadoop кластера на Linux.

С другой стороны, если количество серверов, оптимально требующих различных сред виртуализации делится примерно поровну, имеет смысл делать гетерогенную инфрастуктуру, поскольку в данном случае ресурсы, затрачиваемые на компетенции по поддержке обоих сред могут с лихвой окупится экономией на аппаратуре из-за гораздо более оптимального её использования в рамках наиболее подходящей среды. Первый пришедший в голову пример, когда это __возможно__ имеет смысл - хостинговые компании, которым нужно предоставлять широкий спектр различных серверов. Правда, не исключаю, что в реальности хостеры более склонны иметь единую систему аппаратной или паравиртуализации :-).

В целом, гетерогенная среда является изначально ущербным решением, и нужно иметь веские причины для её использования.
