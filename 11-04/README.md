# Домашнее задание к занятию "11.04 Микросервисы: масштабирование"

> Вы работаете в крупной компанию, которая строит систему на основе микросервисной архитектуры.
> Вам как DevOps специалисту необходимо выдвинуть предложение по организации инфраструктуры, для разработки и эксплуатации.

## Задача 1: Кластеризация

> Предложите решение для обеспечения развертывания, запуска и управления приложениями.
> Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.
> 
> Решение должно соответствовать следующим требованиям:
> - Поддержка контейнеров;
> - Обеспечивать обнаружение сервисов и маршрутизацию запросов;
> - Обеспечивать возможность горизонтального масштабирования;
> - Обеспечивать возможность автоматического масштабирования;
> - Обеспечивать явное разделение ресурсов доступных извне и внутри системы;
> - Обеспечивать возможность конфигурировать приложения с помощью переменных среды, в том числе с возможностью безопасного хранения чувствительных данных таких как пароли, ключи доступа, ключи шифрования и т.п.
> 
> Обоснуйте свой выбор.

В целом, задание выглядит как плавная подводка к теме последующих занятий - Kubernetes :-) Тем не менее, проведём формальный разбор имеющихся систем кластеризации на соответствие указанным в условиях требованиям.

Исключим сразу облачные системы различных провайдеров, поскольку в большинстве своём они построены на одной из систем, разобранных ниже, и к тому же в условии задачи сказано, что необходимо создать решение самому. 

Рассмотрим следующие решения, которые позволяют развернуть системы кластеризации on-premise:

- Kubernetes
- OpenShift
- Rancher
- Nomad
- Docker Swarm

Все данные системы поддерживают docker-type контейнеры.

Kubernetes является сейчас наиболее универсальным и обладающим широкими возможностями решением для управления приложениями. Kubernetes имеет широкие возможности Service Discovery и маршрутизации запросов с явным разделением внутренних и доступных извне ресурсов через механизм Ingress (включая балансирование запросов, SSL терминацию, поддержку DNS для хостов сервисов). Конфигурировать приложения можно с помощью переменных среды, поддерживаются механизмы секретов.

OpenShift построена на основе Kubernetes, и "привязана" к производителю Red Hat (дистрибутив RHEL). Сильной стороной данной системы является возможность одновременной работы как с on-premise, так и с облачными системами различных провайдеров, что позволяет развёртывать сложные распределенные по различным площадкам системы. Другим полезным дополнительным функционалом данной системы является наличие встроенной системы мониторинга и логирования контейнеров на основе Prometeus. 

Rancher также построен поверх Kubernetes (но без привязки к какому-либо дистрибутиву Linux), и ориентирован на централизованное управление несколькими разнородными кластерами Kubernetes, и содержит, в том числе, централизованную систему аутентификации.

Hashicorp Nomad является только системой оркестрации (то есть поддерживает горизонтальное и автоматическое масштабирование) и не имеет функционала по обнаружению сервисов, маршрутизации, разделению ресурсов и хранению секретов. Данные возможности поддерживаются другими, дополняющими друг друга, инструментами HashiCorp, поэтому его использование имеет смысл в комплексе с ними. Отличительной особенностью Nomad является возможность оркестрации обычных приложений (не на основе контейнеров). 

Docker Swarm является самой простой из упомянутых системой оркестрации, более ограниченной по возможностям по сравнению с Kubernetes, и предназначенной для создания небольших кластеров с ограниченным количеством сервисов. Эта система удобна для разработки прежде всего своей простотой (она идёт в комплекте с Docker и в значительной степени совместима с форматом, используемым в Docker Compose), и из-за этой же простоты слабо применима для использования в больших системах в production.

Исходя из описанных особенностей данных систем, моим выбором будет одна из систем, основанная на Kubernetes (так как он является сейчас фактически промышленным стандартом). При прочих равных, я бы остановился на собственно Kubernetes, так как он широко распространён, хорошо документирован, расширяем. В случае необходимости развёртывания на нескольких разнородных системах кластеризации, имеет смысл рассмотреть Rancher. Если привязка к вендору RedHat не является ограничивающим фактором, OpenShift имеет существенный плюс в виде встроенной системой мониторинга и логирования.

Одновременно с этим, Docker Swarm в силу его простоты вполне может быть использован при разработке отдельных сервисов для сборки тестовых стендов. 